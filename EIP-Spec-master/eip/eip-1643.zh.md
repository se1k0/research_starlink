---

eip: ERC-1643
title: 文档管理标准（ERC-1400 安全代币标准的一部分）
author: Adam Dossa (@adamdossa), Pablo Ruiz (@pabloruiz55), Fabian Vogelsteller (@frozeman), Stephane Gosselin (@thegostep)
discussions-to: #1411
status: Draft
type: Standards Track
category: ERC
created: 2018-09-09
require: None

---

## 简单摘要

本标准隶属于与安全代币相关的 ERC-1400（#1411）标准集合。

提供一种标准，用于在智能合约（在 ERC-1400 背景下为安全代币合约）上附加文档，并定义查询/修改这些文档的标准接口，以及在这些文档发生变更时接收更新（通过事件）。

## 摘要

允许将文档与智能合约相关联，并提供标准化接口以查询/修改这些文档，同时在这些文档发生变更时通过事件接收更新。

文档示例包括与安全代币相关的发行说明书与法律标注（legends）。

## 动机

通过指定一组标准接口来加速在以太坊区块链上发行与管理证券，从而让所有相关方都可以对安全代币进行操作与查询。

由于安全代币及其所有权通常包含来自投资者或发行方的权利与义务，因此能够将法律文档与相关合约关联十分重要。以标准化方式实现此点使钱包、交易所与其他生态系统成员能够以标准方式展示这些文档，并使投资者能够以标准方式订阅更新。

## 要求

有关整个标准库的完整需求，请参阅 ERC-1400（#1411）。

以下需求是在与安全代币生态系统参与者讨论后汇编而成：

- 必须支持查询与订阅有关该证券的任何相关文档的更新。

## 设计原理（Rationale）

能够将文档附加到安全代币，使发行方或其他获授权实体可以就与证券相关的文档与代币持有人进行沟通。附加的文档可以选择性地包含其内容的哈希，以便提供不可篡改性保证。

## 规范

以下函数用于管理与代币相关的文档库。这些文档可以是法律文档或其他参考资料。

一个文档与一个短名称（表示为 `bytes32`）、一个修改时间戳关联，并可以选择性地在链上关联文档内容的哈希。

文档通过一个通用的 URI 引用，该 URI 可以指向网站或其他文档门户。

### getDocument

用于返回具有已知名称（`bytes32`）的文档的详细信息。返回与文档关联的 URI（`string`）、文档内容的哈希（`bytes32`），以及最近一次通过 `setDocument` 修改该文档的时间戳（`uint256`）。

``` solidity
function getDocument(bytes32 _name) external view returns (string, bytes32, uint256);
```

### setDocument

用于将新文档附加到合约，或更新已附加文档的 URI 或哈希。

`setDocument` 必须在文档未成功存储时抛出异常（throw/revert）。

`setDocument` 必须在附加或修改文档时，发出 `DocumentUpdated` 事件。

``` solidity
function setDocument(bytes32 _name, string _uri, bytes32 _documentHash) external;
```

### removeDocument

用于通过给定文档名称移除已存在的文档。

`removeDocument` 必须在文档未成功移除时抛出异常。

`removeDocument` 必须在移除文档时，发出 `DocumentRemoved` 事件。

``` solidity
function removeDocument(bytes32 _name) external;
```

### getAllDocuments

用于检索附加到该智能合约的全部文档列表。

任何通过 `setDocument` 添加且随后未通过 `removeDocument` 删除的文档都必须被返回。

``` solidity
function getAllDocuments() view returns (bytes32[]);
```

## 接口

``` solidity
/// @title IERC1643 文档管理（ERC1400 安全代币标准的一部分）
/// @dev 参见 https://github.com/SecurityTokenStandard/EIP-Spec

interface IERC1643 {

    // 文档管理
    function getDocument(bytes32 _name) external view returns (string, bytes32, uint256);
    function setDocument(bytes32 _name, string _uri, bytes32 _documentHash) external;
    function removeDocument(bytes32 _name) external;
    function getAllDocuments() external view returns (bytes32[]);

    // 文档事件
    event DocumentRemoved(bytes32 indexed _name, string _uri, bytes32 _documentHash);
    event DocumentUpdated(bytes32 indexed _name, string _uri, bytes32 _documentHash);

}
```

## 参考
- [EIP 1400: 带分区的安全代币标准](https://github.com/ethereum/EIPs/issues/1411)
- [EIP 草案](https://github.com/SecurityTokenStandard/EIP-Spec)

